<!DOCTYPE html>
<html lang="vi"><head>
  <meta charset="UTF-8">
  <title>B√ÅO C√ÅO KH·ªêI L∆Ø·ª¢NG THEO NH√Ä TH·∫¶U</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- XLSX & Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root {
      --primary: #0054a6;
      --primary-light: #e3f4ff;
      --accent-cyan: #00bcd4;
      --bg: #f3f7fb;
      --bg-card: #ffffff;
      --text: #1b2440;
      --text-muted: #6b7a99;
      --border: #d3deee;
    }

    body.dark-mode {
      --bg: #050914;
      --bg-card: #0f172a;
      --text: #e5f0ff;
      --text-muted: #7b8caf;
      --border: #1f2937;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, rgba(0,188,212,0.12), transparent 45%),
                  radial-gradient(circle at bottom right, rgba(0,84,166,0.12), transparent 45%),
                  var(--bg);
      color: var(--text);
    }

    .container {
      max-width: 1180px;
      margin: 0 auto;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 18px 18px 20px;
      box-shadow: 0 18px 45px rgba(15,23,42,0.22);
      border: 1px solid rgba(255,255,255,0.6);
    }

    body.dark-mode .container {
      background: rgba(15,23,42,0.96);
      border-color: rgba(30,64,175,0.6);
    }

    header { display:flex; flex-direction:column; gap:8px; margin-bottom:10px; }

    .header-top {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .title-block { max-width:60%; }

    h1 {
      margin:0 0 4px;
      font-size:20px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:var(--primary);
    }
    body.dark-mode h1 { color:#60a5fa; }

    .subtitle { font-size:12px; color:var(--text-muted); }

    .meta-row {
      display:flex;
      gap:16px;
      font-size:12px;
      color:var(--text-muted);
    }
    .meta-row span label {
      font-weight:600;
      color:var(--text);
      margin-right:4px;
    }

    .toolbar {
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
      gap:6px;
      margin-top:4px;
    }

    .btn {
      border:1px solid var(--border);
      background:linear-gradient(135deg, #ffffff, #f3f7ff);
      padding:6px 10px;
      border-radius:999px;
      font-size:11px;
      display:inline-flex;
      align-items:center;
      gap:5px;
      cursor:pointer;
      color:var(--text);
      box-shadow:0 2px 5px rgba(15,23,42,0.08);
      transition:all 0.15s ease-out;
    }
    .btn:hover { transform:translateY(-1px); box-shadow:0 4px 8px rgba(15,23,42,0.15); }
    .btn.primary {
      background:linear-gradient(135deg,#0054a6,#00bcd4);
      border-color:transparent;
      color:#fff;
    }
    body.dark-mode .btn {
      background:linear-gradient(135deg,#0f172a,#020617);
      color:var(--text);
      border-color:#1f2937;
    }
    body.dark-mode .btn.primary {
      background:linear-gradient(135deg,#2563eb,#0ea5e9);
    }
    .btn input[type="file"] { display:none; }
    .btn-icon { font-size:14px; }

    .tabs-wrapper {
      margin-top:16px;
      background:var(--bg-card);
      border-radius:16px;
      border:1px solid var(--border);
      padding:12px;
      box-shadow:0 4px 12px rgba(15,23,42,0.06);
    }
    body.dark-mode .tabs-wrapper {
      background:linear-gradient(145deg,rgba(15,23,42,0.96),rgba(17,24,39,0.96));
    }

    .tabs {
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      border-bottom:1px solid var(--border);
      padding-bottom:6px;
      margin-bottom:10px;
    }
    .tab {
      border:none;
      background:transparent;
      padding:6px 12px;
      font-size:11px;
      border-radius:999px;
      cursor:pointer;
      color:var(--text-muted);
      position:relative;
    }
    .tab::after {
      content:"";
      position:absolute;
      left:14px;
      right:14px;
      bottom:-4px;
      height:2px;
      border-radius:999px;
      background:transparent;
    }
    .tab.active {
      background:rgba(0,84,166,0.08);
      color:var(--primary);
      font-weight:600;
    }
    .tab.active::after {
      background:linear-gradient(90deg,var(--primary),var(--accent-cyan));
    }

    .summary-grid {
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
      margin-bottom:10px;
    }
    .summary-card {
      position:relative;
      background:linear-gradient(135deg,rgba(0,188,212,0.12),rgba(0,84,166,0.04));
      border-radius:16px;
      border:1px solid var(--border);
      padding:10px 12px 12px;
      overflow:hidden;
    }
    body.dark-mode .summary-card {
      background:radial-gradient(circle at top left,rgba(37,99,235,0.22),rgba(15,23,42,0.9));
    }
    .summary-card::before {
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at top right,rgba(0,188,212,0.25),transparent 55%);
      pointer-events:none;
    }
    .summary-card > * { position:relative; z-index:1; }

    .summary-label {
      font-size:11px;
      color:var(--text-muted);
      margin-bottom:4px;
      letter-spacing:0.06em;
      text-transform:uppercase;
    }
    .summary-main-value {
      font-size:20px;
      font-weight:700;
      color:var(--primary);
      margin-bottom:4px;
    }
    body.dark-mode .summary-main-value { color:#bfdbfe; }
    .summary-subtext { font-size:11px; color:var(--text-muted); }

    .card-subtitle {
      font-size:11px;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.04em;
      color:var(--text-muted);
      margin-top:4px;
      margin-bottom:2px;
    }
    .bands-row { margin-top:2px; }

    .details-grid {
      display:grid;
      grid-template-columns:minmax(0,1fr);
      gap:10px;
      margin-top:4px;
    }

    .card {
      background:rgba(255,255,255,0.9);
      border-radius:14px;
      border:1px solid var(--border);
      padding:10px 10px 10px;
      box-shadow:0 3px 10px rgba(15,23,42,0.06);
    }
    body.dark-mode .card {
      background:rgba(15,23,42,0.94);
      border-color:#1f2937;
    }

    .card-title {
      font-size:12px;
      font-weight:600;
      margin-bottom:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:var(--text);
    }
    .card-title span { font-size:11px; font-weight:400; color:var(--text-muted); }

    .badge {
      display:inline-flex;
      align-items:center;
      border-radius:999px;
      padding:2px 6px;
      font-size:10px;
      border:1px solid rgba(148,163,184,0.7);
      color:var(--text-muted);
      gap:4px;
    }
    .badge-dot {
      width:6px; height:6px;
      border-radius:999px;
      background:#22c55e;
    }

    .table-wrapper {
      margin-top:4px;
      border-radius:10px;
      border:1px solid var(--border);
      overflow:hidden;
      background:rgba(255,255,255,0.95);
    }
    body.dark-mode .table-wrapper { background:rgba(15,23,42,0.98); }

    table {
      width:100%;
      border-collapse:collapse;
      font-size:11px;
      table-layout:fixed;
    }

    thead {
      background:linear-gradient(135deg,#eff4ff,#e0f7ff);
    }
    body.dark-mode thead {
      background:linear-gradient(135deg,#111827,#020617);
    }

    th, td {
      padding:4px 6px;
      border-bottom:1px solid rgba(210,220,235,0.9);
      text-align:left;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* ƒê·∫∑t width c·ªë ƒë·ªãnh cho 8 c·ªôt ƒë·∫ßu, c·ªôt 9 (Ghi ch√∫) s·∫Ω ƒÉn h·∫øt ph·∫ßn c√≤n l·∫°i */
    .table-main th:nth-child(1),
    .table-main td:nth-child(1) { width:60px; }   /* G√≥i th·∫ßu */
    .table-main th:nth-child(2),
    .table-main td:nth-child(2) { width:150px; }  /* H·∫°ng m·ª•c */
    .table-main th:nth-child(3),
    .table-main td:nth-child(3) { width:60px; }   /* ƒê∆°n v·ªã */
    .table-main th:nth-child(4),
    .table-main td:nth-child(4),
    .table-main th:nth-child(5),
    .table-main td:nth-child(5),
    .table-main th:nth-child(6),
    .table-main td:nth-child(6),
    .table-main th:nth-child(7),
    .table-main td:nth-child(7),
    .table-main th:nth-child(8),
    .table-main td:nth-child(8) { width:80px; text-align:right; }

    .table-main th:nth-child(9),
    .table-main td:nth-child(9) { padding-right:0; }

    .note-cell {
      display:block;
      max-width:100%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      box-sizing:border-box;
    }

    tbody tr:nth-child(even) { background:rgba(248,250,252,0.9); }
    body.dark-mode tbody tr:nth-child(even) { background:rgba(15,23,42,0.9); }
    tbody tr:hover { background:rgba(219,234,254,0.75); }
    body.dark-mode tbody tr:hover { background:rgba(30,64,175,0.35); }

    /* D√≤ng ƒë∆∞·ª£c ch·ªçn */
    .row-selected {
      background:rgba(59,130,246,0.18) !important;
    }

    .filters-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      font-size:11px;
      margin-bottom:6px;
      color:var(--text-muted);
    }
    .filters-row label {
      display:inline-flex;
      align-items:center;
      gap:4px;
    }

    select {
      font-size:11px;
      padding:3px 6px;
      border-radius:8px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.95);
      color:var(--text);
    }
    body.dark-mode select {
      background:#020617;
      color:var(--text);
    }

    .chip {
      font-size:10px;
      border-radius:999px;
      padding:2px 7px;
      border:1px solid rgba(148,163,184,0.7);
      color:var(--text-muted);
      margin-left:4px;
    }

    .chart-split { display:flex; flex-wrap:wrap; gap:8px; margin-top:4px; }
    .chart-half { flex:1 1 0; min-width:140px; height:180px; position:relative; }
    .chart-half canvas { width:100%; height:100%; }

    .chart-legend {
      font-size:10px;
      color:var(--text-muted);
      margin-top:4px;
      display:flex;
      justify-content:flex-start;
      gap:10px;
      flex-wrap:wrap;
    }
    .legend-item { display:inline-flex; align-items:center; gap:4px; }
    .legend-color { width:10px; height:10px; border-radius:3px; }

    .tag {
      display:inline-flex;
      align-items:center;
      border-radius:999px;
      padding:2px 6px;
      font-size:10px;
      border:1px solid transparent;
      gap:4px;
    }
    .tag-open {
      background:rgba(248,113,113,0.08);
      border-color:rgba(248,113,113,0.5);
      color:#b91c1c;
    }
    .tag-progress {
      background:rgba(251,191,36,0.08);
      border-color:rgba(251,191,36,0.5);
      color:#92400e;
    }
    .tag-closed {
      background:rgba(52,211,153,0.08);
      border-color:rgba(52,211,153,0.5);
      color:#065f46;
    }

    /* Kh·ªëi detail view */
    .detail-grid {
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:4px 16px;
      font-size:11px;
      margin-top:4px;
    }
    .detail-row {
      display:flex;
      align-items:flex-start;
      gap:4px;
    }
    .detail-label {
      font-weight:600;
      color:var(--text-muted);
      min-width:90px;
      flex-shrink:0;
    }
    .detail-value {
      color:var(--text);
      white-space:pre-wrap;
      word-break:break-word;
    }
    .detail-empty {
      font-size:11px;
      color:var(--text-muted);
      font-style:italic;
      margin-top:2px;
    }

    @media (max-width:960px) {
      .summary-grid { grid-template-columns:repeat(2,minmax(0,1fr)); }
      .details-grid { grid-template-columns:1fr; }
      .title-block { max-width:100%; }
      .detail-grid { grid-template-columns:1fr; }
    }
    @media (max-width:720px) {
      .summary-grid { grid-template-columns:1fr; }
      .meta-row { flex-direction:column; gap:4px; }
      .toolbar { justify-content:flex-start; }
    }

    @media print {
      body { background:#ffffff; padding:0; }
      .container { box-shadow:none; border-radius:0; border:none; }
      .toolbar, #btnTheme { display:none !important; }
      .tabs-wrapper { border:none; box-shadow:none; }
      .tab { border-radius:0; }
      .detail-empty { display:none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-top">
        <div class="title-block">
          <h1 contenteditable="true">B√ÅO C√ÅO KH·ªêI L∆Ø·ª¢NG THEO NH√Ä TH·∫¶U</h1>
          <div class="subtitle">
            B√°o c√°o t·ªïng h·ª£p kh·ªëi l∆∞·ª£ng th·ª±c hi·ªán, ti·∫øn ƒë·ªô h·ª£p ƒë·ªìng v√† t√¨nh tr·∫°ng v∆∞·ªõng m·∫Øc theo t·ª´ng nh√† th·∫ßu.
          </div>
        </div>
        <div class="meta">
          <div class="meta-row">
            <span><label>Ng∆∞·ªùi b√°o c√°o:</label> <span contenteditable="true" id="reportAuthor">________________</span></span>
          </div>
          <div class="meta-row">
            <span><label>Ng√†y b√°o c√°o:</label> <span id="reportDate">03/01/2026</span></span>
          </div>
        </div>
      </div>
      <div class="toolbar">
        <label class="btn primary">
          <span class="btn-icon">üìÇ</span> Nh·∫≠p Excel
          <input type="file" id="excelFile" accept=".xlsx,.xls">
        </label>
        <button class="btn" id="btnExportExcel"><span class="btn-icon">‚¨á</span> Xu·∫•t Excel</button>
        <button class="btn" id="btnExportPdf"><span class="btn-icon">üìÑ</span> Xu·∫•t PDF</button>
        <button class="btn" id="btnExportHtml"><span class="btn-icon">üß∑</span> Xu·∫•t HTML tƒ©nh</button>
        <button class="btn" id="btnTheme"><span class="btn-icon">‚òÄ</span> Light / Dark</button>
      </div>
    </header>

    <div class="tabs-wrapper">
      <div id="tabs" class="tabs"><button class="tab active">T·ªïng Quan - H·ªì s∆°</button><button class="tab">ASIA TECH</button></div>
      <div id="contractor-content"><div class="summary-grid">
        <div class="summary-card">
          <div class="summary-label">Ti·∫øn ƒë·ªô h·ª£p ƒë·ªìng</div>
          <div class="summary-main-value">2.3%</div>
        </div>
      
        <div class="summary-card">
          <div class="summary-label">Ti·∫øn ƒë·ªô h·ªì s∆°</div>
          <div class="summary-main-value">
            0/9 h·ªì s∆° ho√†n th√†nh
          </div>
          <div class="summary-subtext">
            ƒêang x·ª≠ l√Ω: <strong>0</strong> &nbsp;|&nbsp;
            Ch∆∞a ho√†n th√†nh: <strong>9</strong>
          </div>
        </div>
      </div><h2 style="font-size:14px;margin:12px 4px 6px;">T·ªïng quan ti·∫øn ƒë·ªô h·ª£p ƒë·ªìng</h2><div class="table-wrapper"><table class="table-main"><thead><tr><th title="STT">STT</th><th title="Nh√† th·∫ßu">Nh√† th·∫ßu</th><th title="G√≥i th·∫ßu">G√≥i th·∫ßu</th><th title="Ti·∫øn ƒë·ªô Hƒê (ng√†y)">Ti·∫øn ƒë·ªô Hƒê (ng√†y)</th><th title="Ng√†y kh·ªüi c√¥ng">Ng√†y kh·ªüi c√¥ng</th><th title="Ng√†y k·∫øt th√∫c">Ng√†y k·∫øt th√∫c</th><th title="Ng√†y th·ª±c hi·ªán">Ng√†y th·ª±c hi·ªán</th><th title="Ng√†y c√≤n l·∫°i">Ng√†y c√≤n l·∫°i</th><th title="T·ª∑ l·ªá ho√†n th√†nh">T·ª∑ l·ªá ho√†n th√†nh</th></tr></thead><tbody><tr><td title="1">1</td><td title="ASIA TECH">ASIA TECH</td><td title="GT01">GT01</td><td style="text-align:right;" title="425">425</td><td title="20/11/2025">20/11/2025</td><td title="19/01/2027">19/01/2027</td><td style="text-align:right;" title="44">44</td><td style="text-align:right;" title="381">381</td><td style="text-align:right;" title="2.3%">2.3%</td></tr></tbody></table></div><h2 style="font-size:14px;margin:16px 4px 6px;">Ti·∫øn ƒë·ªô h·ªì s∆°</h2><div class="table-wrapper"><table class="table-main"><thead><tr><th title="STT">STT</th><th title="T√™n h·ªì s∆°">T√™n h·ªì s∆°</th><th title="Ng√†y tr√¨nh duy·ªát">Ng√†y tr√¨nh duy·ªát</th><th title="T√¨nh tr·∫°ng">T√¨nh tr·∫°ng</th><th title="Ng√†y ph√™ duy·ªát">Ng√†y ph√™ duy·ªát</th></tr></thead><tbody><tr><td title="1">1</td><td title="I. Nh√† th·∫ßu ASIA TECH">I. Nh√† th·∫ßu ASIA TECH</td><td></td><td></td><td></td></tr><tr><td title="2">2</td><td title="H·ªì s∆° ƒë∆°n v·ªã cung c·∫•p c·ªçc Amacao">H·ªì s∆° ƒë∆°n v·ªã cung c·∫•p c·ªçc Amacao</td><td title="25/11/2025">25/11/2025</td><td title="Duy·ªát c√≥ √Ω ki·∫øn">Duy·ªát c√≥ √Ω ki·∫øn</td><td title="28/11/2025">28/11/2025</td></tr><tr><td title="3">3</td><td title="H·ªì s∆° ƒë∆°n v·ªã √©p c·ªçc v√† ƒë∆°n v·ªã th√≠ nghi·ªám n√©n tƒ©nh LASXD1780">H·ªì s∆° ƒë∆°n v·ªã √©p c·ªçc v√† ƒë∆°n v·ªã th√≠ nghi·ªám n√©n tƒ©nh LASXD1780</td><td title="25/11/2025">25/11/2025</td><td title="Duy·ªát c√≥ √Ω ki·∫øn">Duy·ªát c√≥ √Ω ki·∫øn</td><td title="28/11/2025">28/11/2025</td></tr><tr><td title="4">4</td><td title="Ph√≤ng th√≠ nghi·ªám Las-XD 23.004">Ph√≤ng th√≠ nghi·ªám Las-XD 23.004</td><td title="25/11/2025">25/11/2025</td><td title="Duy·ªát c√≥ √Ω ki·∫øn">Duy·ªát c√≥ √Ω ki·∫øn</td><td title="28/11/2025">28/11/2025</td></tr><tr><td title="5">5</td><td title="H·ªì s∆° v·∫≠t li·ªáu san l·∫•p: M·ªè ƒë√° ƒê·ª©c Nam">H·ªì s∆° v·∫≠t li·ªáu san l·∫•p: M·ªè ƒë√° ƒê·ª©c Nam</td><td title="25/11/2025">25/11/2025</td><td title="Duy·ªát c√≥ √Ω ki·∫øn">Duy·ªát c√≥ √Ω ki·∫øn</td><td title="28/11/2025">28/11/2025</td></tr><tr><td title="6">6</td><td title="H·ªì s∆° v·∫≠t li·ªáu M·ªè ƒë·∫•t c√¥ng ty Hi·ªáp Ph√°t C·∫©m Th·ªßy">H·ªì s∆° v·∫≠t li·ªáu M·ªè ƒë·∫•t c√¥ng ty Hi·ªáp Ph√°t C·∫©m Th·ªßy</td><td title="25/11/2025">25/11/2025</td><td title="Duy·ªát c√≥ √Ω ki·∫øn">Duy·ªát c√≥ √Ω ki·∫øn</td><td title="28/11/2025">28/11/2025</td></tr><tr><td title="7">7</td><td title="H·ªì s∆° k·∫ø ho·∫°ch th√≠ nghi·ªám">H·ªì s∆° k·∫ø ho·∫°ch th√≠ nghi·ªám</td><td title="25/11/2025">25/11/2025</td><td title="Duy·ªát c√≥ √Ω ki·∫øn">Duy·ªát c√≥ √Ω ki·∫øn</td><td title="28/11/2025">28/11/2025</td></tr><tr><td title="8">8</td><td title="H·ªì s∆° Ban ch·ªâ huy d·ª± √°n">H·ªì s∆° Ban ch·ªâ huy d·ª± √°n</td><td title="25/11/2025">25/11/2025</td><td title="Duy·ªát c√≥ √Ω ki·∫øn">Duy·ªát c√≥ √Ω ki·∫øn</td><td title="28/11/2025">28/11/2025</td></tr><tr><td title="9">9</td><td title="Ti·∫øn ƒë·ªô thi c√¥ng">Ti·∫øn ƒë·ªô thi c√¥ng</td><td title="25/11/2025">25/11/2025</td><td title="Duy·ªát c√≥ √Ω ki·∫øn">Duy·ªát c√≥ √Ω ki·∫øn</td><td title="28/11/2025">28/11/2025</td></tr></tbody></table></div></div>
    </div>
  </div>

  <script id="embedded-data-json" type="application/json">{"contractors":{"ASIA TECH":{"reportItems":[{"contractor":"ASIA TECH","pkg":"GT01","item":"A. C√¥ng t√°c chu·∫©n b·ªã","unit":"","contractQty":100,"prevCum":100,"thisWeek":0,"cum":100,"pct":100,"note":"ƒê·∫•u n·ªëi ƒëi·ªán n∆∞·ªõc, l√†m vi·ªác v·ªõi c∆° quan ch·ª©c nƒÉng v√† ch√≠nh quy·ªÅn ƒë·ªãa ph∆∞∆°ng c√°c th·ªß t·ª•c c·∫•p ph√©p t·∫°m thi c√¥ng, nh·∫≠n b√†n giao m·∫∑t b·∫±ng, huy ƒë·ªông m√°y m√≥c thi·∫øt b·ªã, nh√¢n l·ª±c‚Ä¶"},{"contractor":"ASIA TECH","pkg":"GT01","item":"B. C√¥ng t√°c thi c√¥ng - Ph·∫ßn x√¢y d·ª±ng","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"I. San l·∫•p ph·∫°m vi giai ƒëo·∫°n 1","unit":"%","contractQty":100,"prevCum":50,"thisWeek":10,"cum":60,"pct":60,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"II. Ph·∫ßn c·ªçc","unit":"","contractQty":0,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":"Chu·∫©n b·ªã √©p c·ªçc th√≠ nghi·ªám"},{"contractor":"ASIA TECH","pkg":"GT01","item":"1. √âp c·ªçc th·ª≠","unit":"%","contractQty":100,"prevCum":0,"thisWeek":50,"cum":50,"pct":50,"note":"√âp c·ªçc th·ª≠ 01"},{"contractor":"ASIA TECH","pkg":"GT01","item":"2. √âp c·ªçc ƒë·∫°i tr√†","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"III. Ph·∫ßn b·ªÉ","unit":"","contractQty":0,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"1. Tr·∫°m b∆°m n∆∞·ªõc ƒë·∫ßu v√†o","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"2. C·ª•m b·ªÉ - modul 1","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"3. H·ªì s·ª± c·ªë - modul 1","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"4. M∆∞∆°ng quan tr·∫Øc","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"5. Tr·∫°m b∆°m n∆∞·ªõc sau x·ª≠ l√Ω","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"6. B·ªá m√°y ƒë·∫∑t h·ªá th·ªëng l·ªçc sau x·ª≠ l√Ω","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"IV. Ph·∫ßn nh√†","unit":"","contractQty":0,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"1. Nh√† b·∫£o v·ªá","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"2. Nh√† xe","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"3. Nh√† ƒë·∫∑t m√°y ph√°t ƒëi·ªán","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"4. Nh√† h√≥a ch·∫•t, ch·∫•t th·∫£i","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"5. Nh√† √©p - ch·ª©a b√πn","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"6. Nh√† ƒëi·ªÅu h√†nh","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"7. Nh√† quan tr·∫Øc","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"8. Tr·∫°m bi·∫øn √°p (bao che b·∫£o v·ªá an to√†n tr·∫°m bi·∫øn √°p)","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"9. Nh√† ngh·ªâ nh√¢n vi√™n","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"10. Nh√† xe pccc","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"V. Ph·∫ßn h·∫° t·∫ßng","unit":"","contractQty":0,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"1. H√†ng r√†o","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"2. ƒê∆∞·ªùng n·ªôi b·ªô-s√¢n n·ªÅn","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"3. Tho√°t n∆∞·ªõc m∆∞a","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"4. Tuy·∫øn ·ªëng ƒë·∫ßu v√†o","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"VI. Ph·∫ßn n·ªôi th·∫•t","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"C. C√¥ng t√°c thi c√¥ng - Ph·∫ßn thi·∫øt b·ªã","unit":"","contractQty":0,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"1. T·∫≠p k·∫øt thi·∫øt b·ªã v·ªÅ site","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"2. L·∫Øp ƒë·∫∑t ƒë∆∞·ªùng ·ªëng c√¥ng ngh·ªá","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"3. L·∫Øp ƒë·∫∑t thi·∫øt b·ªã","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""},{"contractor":"ASIA TECH","pkg":"GT01","item":"4. Th√≠ nghi·ªám, ch·∫°y th·ª≠ ƒë∆°n ƒë·ªông","unit":"%","contractQty":100,"prevCum":0,"thisWeek":0,"cum":0,"pct":0,"note":""}],"issues":[]}},"overview":[{"contractor":"ASIA TECH","pkg":"GT01","contractDays":425,"startDate":45981,"endDate":46406,"daysDone":44,"daysRemain":381,"ratio":0.022727272727272728}],"documents":[{"name":"I. Nh√† th·∫ßu ASIA TECH","submitDate":"","status":"","approvedDate":""},{"name":"H·ªì s∆° ƒë∆°n v·ªã cung c·∫•p c·ªçc Amacao","submitDate":45986,"status":"Duy·ªát c√≥ √Ω ki·∫øn","approvedDate":45989},{"name":"H·ªì s∆° ƒë∆°n v·ªã √©p c·ªçc v√† ƒë∆°n v·ªã th√≠ nghi·ªám n√©n tƒ©nh LASXD1780","submitDate":45986,"status":"Duy·ªát c√≥ √Ω ki·∫øn","approvedDate":45989},{"name":"Ph√≤ng th√≠ nghi·ªám Las-XD 23.004","submitDate":45986,"status":"Duy·ªát c√≥ √Ω ki·∫øn","approvedDate":45989},{"name":"H·ªì s∆° v·∫≠t li·ªáu san l·∫•p: M·ªè ƒë√° ƒê·ª©c Nam","submitDate":45986,"status":"Duy·ªát c√≥ √Ω ki·∫øn","approvedDate":45989},{"name":"H·ªì s∆° v·∫≠t li·ªáu M·ªè ƒë·∫•t c√¥ng ty Hi·ªáp Ph√°t C·∫©m Th·ªßy","submitDate":45986,"status":"Duy·ªát c√≥ √Ω ki·∫øn","approvedDate":45989},{"name":"H·ªì s∆° k·∫ø ho·∫°ch th√≠ nghi·ªám","submitDate":45986,"status":"Duy·ªát c√≥ √Ω ki·∫øn","approvedDate":45989},{"name":"H·ªì s∆° Ban ch·ªâ huy d·ª± √°n","submitDate":45986,"status":"Duy·ªát c√≥ √Ω ki·∫øn","approvedDate":45989},{"name":"Ti·∫øn ƒë·ªô thi c√¥ng","submitDate":45986,"status":"Duy·ªát c√≥ √Ω ki·∫øn","approvedDate":45989}],"meta":{"generatedAt":"2026-01-03T06:34:22.307Z","author":"________________","reportDate":"03/01/2026"}}</script>

  <script>
    let dataStore = { contractors: {}, overview: [], documents: [], meta: {} };
    let charts = [];

    // ==========================
    // KH·ªûI T·∫†O
    // ==========================
    (function initReportDate() {
      const span = document.getElementById('reportDate');
      if (!span || span.textContent.trim()) return;
      const t = new Date();
      const dd = String(t.getDate()).padStart(2,'0');
      const mm = String(t.getMonth()+1).padStart(2,'0');
      const yyyy = t.getFullYear();
      span.textContent = dd + '/' + mm + '/' + yyyy;
    })();

    document.getElementById('excelFile').addEventListener('change', handleFile, false);

    const embedded = document.getElementById('embedded-data-json');
    if (embedded && embedded.textContent.trim()) {
      try {
        const obj = JSON.parse(embedded.textContent.trim());
        if (obj && obj.contractors) {
          dataStore = obj;
          renderAll();
          applyEllipsisTooltips();
        }
      } catch (e) {
        console.warn('Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c embedded data:', e);
      }
    }

    // ==========================
    // ƒê·ªåC EXCEL
    // ==========================
    function handleFile(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        const data = new Uint8Array(evt.target.result);
        const wb = XLSX.read(data, { type: 'array' });

        const sheetReport  = wb.Sheets['B√°o c√°o thi c√¥ng'] || wb.Sheets[wb.SheetNames[0]];
        const sheetIssues  = wb.Sheets['Vuong mac']        || wb.Sheets[wb.SheetNames[1]];
        const sheetOverview= wb.Sheets['t·ªïng quan']        || wb.Sheets['T·ªïng quan'];
        const sheetDocs    = wb.Sheets['Ti·∫øn ƒë·ªô h·ªì s∆°']    || wb.Sheets['Tien do ho so'];

        parseReportSheet(sheetReport);
        if (sheetIssues)   parseIssuesSheet(sheetIssues);
        if (sheetOverview) parseOverviewSheet(sheetOverview);
        if (sheetDocs)     parseDocsSheet(sheetDocs);

        renderAll();
        applyEllipsisTooltips();
      };
      reader.readAsArrayBuffer(file);
    }

    function parseReportSheet(sheet) {
      dataStore.contractors = {};
      if (!sheet) return;
      const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: '' });

      let lastContractor = '';
      let lastPkg = '';

      for (let i = 3; i < rows.length; i++) {
        const r = rows[i];
        if (!r || r.length === 0) continue;

        let contractor = r[0] ? String(r[0]).trim() : '';
        if (!contractor) contractor = lastContractor;
        lastContractor = contractor;
        if (!contractor) continue;

        let pkg = r[1] ? String(r[1]).trim() : '';
        if (!pkg) pkg = lastPkg;
        lastPkg = pkg;

        const item = r[2] ? String(r[2]).trim() : '';
        if (!item) continue;

        const unit = r[3] ? String(r[3]).trim() : '';

        const contractQty = Number(r[4]) || 0;
        const prevCum     = Number(r[5]) || 0;
        const thisWeek    = Number(r[6]) || 0;
        let   cum         = Number(r[7]) || 0;
        const note        = r[9] ? String(r[9]).trim() : '';

        if (!cum && (prevCum || thisWeek)) cum = prevCum + thisWeek;

        let pct = 0;
        if (contractQty > 0 && cum >= 0) pct = (cum / contractQty) * 100;

        if (!dataStore.contractors[contractor]) {
          dataStore.contractors[contractor] = { reportItems: [], issues: [] };
        }
        dataStore.contractors[contractor].reportItems.push({
          contractor, pkg, item, unit,
          contractQty, prevCum, thisWeek, cum, pct, note
        });
      }
    }

    function parseIssuesSheet(sheet) {
      const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: '' });
      let lastContractor = '';

      Object.keys(dataStore.contractors).forEach(k => dataStore.contractors[k].issues = []);

      for (let i = 1; i < rows.length; i++) {
        const r = rows[i];
        if (!r || r.length === 0) continue;

        let contractor = r[0] ? String(r[0]).trim() : '';
        if (!contractor) contractor = lastContractor;
        lastContractor = contractor;
        if (!contractor) continue;

        const item       = r[1] ? String(r[1]).trim() : '';
        const issue      = r[2] ? String(r[2]).trim() : '';
        const proposal   = r[3] ? String(r[3]).trim() : '';
        const dateRaised = r[4] || '';
        const status     = r[5] ? String(r[5]).trim() : '';
        const owner      = r[6] ? String(r[6]).trim() : '';
        const dueDate    = r[7] || '';

        if (!dataStore.contractors[contractor]) {
          dataStore.contractors[contractor] = { reportItems: [], issues: [] };
        }
        dataStore.contractors[contractor].issues.push({
          item, issue, proposal, dateRaised, status, owner, dueDate
        });
      }
    }

    function parseOverviewSheet(sheet) {
      dataStore.overview = [];
      if (!sheet) return;
      const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: '' });
      for (let i = 1; i < rows.length; i++) {
        const r = rows[i];
        if (!r || r.length === 0) continue;

        const contractor = r[0] ? String(r[0]).trim() : '';
        const pkg        = r[1] ? String(r[1]).trim() : '';
        if (!contractor && !pkg) continue;

        const contractDays = Number(r[2]) || 0;
        const startDate    = r[3] || '';
        const endDate      = r[4] || '';
        const daysDone     = Number(r[5]) || 0;
        const daysRemain   = Number(r[6]) || 0;
        let ratio = 0;
        if (typeof r[7] === 'number') ratio = r[7];
        else if (r[7] !== '' && r[7] != null) ratio = Number(r[7]) || 0;

        dataStore.overview.push({
          contractor, pkg, contractDays,
          startDate, endDate, daysDone, daysRemain, ratio
        });
      }
    }

    function parseDocsSheet(sheet) {
      dataStore.documents = [];
      if (!sheet) return;
      const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: '' });

      for (let i = 1; i < rows.length; i++) {
        const r = rows[i];
        if (!r || r.length === 0) continue;

        const name         = r[0] ? String(r[0]).trim() : '';
        const submitDate   = r[1] || '';
        const status       = r[2] ? String(r[2]).trim() : '';
        const approvedDate = r[3] || '';

        if (!name && !status) continue;

        dataStore.documents.push({
          name, submitDate, status, approvedDate
        });
      }
    }

    // ==========================
    // TI·ªÜN √çCH
    // ==========================
    function formatExcelDate(value) {
      if (!value) return '';
      if (value instanceof Date) {
        const dd = String(value.getDate()).padStart(2,'0');
        const mm = String(value.getMonth()+1).padStart(2,'0');
        const yyyy = value.getFullYear();
        return dd + '/' + mm + '/' + yyyy;
      }
      if (typeof value === 'number') {
        const d = XLSX.SSF ? XLSX.SSF.parse_date_code(value) : null;
        if (d) {
          const dd = String(d.d).padStart(2,'0');
          const mm = String(d.m).padStart(2,'0');
          const yyyy = d.y;
          return dd + '/' + mm + '/' + yyyy;
        }
      }
      if (typeof value === 'string') {
        const s = value.trim();
        if (!s) return '';
        if (/^\d{1,2}\/\d{1,2}\/\d{2,4}$/.test(s)) return s;
        const dt = new Date(s);
        if (!isNaN(dt.getTime())) {
          const dd = String(dt.getDate()).padStart(2,'0');
          const mm = String(dt.getMonth()+1).padStart(2,'0');
          const yyyy = dt.getFullYear();
          return dd + '/' + mm + '/' + yyyy;
        }
        return s;
      }
      return String(value);
    }

    function formatPercent(value) {
      const num = typeof value === 'number' ? value : Number(value);
      if (!isFinite(num)) return '';
      const pct = num > 1.01 ? num : num * 100;
      return pct.toFixed(1).replace(/\.0$/,'') + '%';
    }

    function getIssueTagClass(status) {
      const s = (status || '').toLowerCase();
      if (!s) return 'tag-open';
      if (s.includes('ch∆∞a') || s.includes('open')) return 'tag-open';
      if (s.includes('ƒëang') || s.includes('progress')) return 'tag-progress';
      return 'tag-closed';
    }

    function applyEllipsisTooltips(root) {
      const container = root || document.getElementById('contractor-content');
      if (!container) return;
      const cells = container.querySelectorAll('th, td');
      cells.forEach(cell => {
        const text = cell.textContent.trim();
        if (!text) return;
        if (!cell.title) cell.title = text;
      });
    }

    // ==========================
    // RENDER TABS
    // ==========================
    function renderAll() {
      const tabsEl = document.getElementById('tabs');
      if (!tabsEl) return;
      tabsEl.innerHTML = '';

      const overviewTab = document.createElement('button');
      overviewTab.className = 'tab';
      overviewTab.textContent = 'T·ªïng Quan - H·ªì s∆°';
      overviewTab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        overviewTab.classList.add('active');
        renderOverviewTab();
      });
      tabsEl.appendChild(overviewTab);

      const contractors = Object.keys(dataStore.contractors || {});
      contractors.forEach(name => {
        const btn = document.createElement('button');
        btn.className = 'tab';
        btn.textContent = name;
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          btn.classList.add('active');
          renderContractor(name);
        });
        tabsEl.appendChild(btn);
      });

      if ((dataStore.overview && dataStore.overview.length) ||
          (dataStore.documents && dataStore.documents.length)) {
        overviewTab.classList.add('active');
        renderOverviewTab();
      } else if (contractors.length) {
        const firstBtn = tabsEl.querySelectorAll('.tab')[1];
        if (firstBtn) {
          firstBtn.classList.add('active');
          renderContractor(contractors[0]);
        }
      } else {
        const contentEl = document.getElementById('contractor-content');
        if (contentEl) {
          contentEl.innerHTML = '<p style="font-size:12px;color:var(--text-muted);margin:8px 4px;">H√£y nh·∫≠p file Excel ƒë·ªÉ xem b√°o c√°o.</p>';
        }
      }
    }

    // ==========================
    // T·ªîNG QUAN
    // ==========================
    function renderOverviewTab() {
      const contentEl = document.getElementById('contractor-content');
      const overview = dataStore.overview || [];
      const docs = dataStore.documents || [];

      if (!overview.length && !docs.length) {
        contentEl.innerHTML = '<p style="font-size:12px;color:var(--text-muted);margin:8px 4px;">Kh√¥ng c√≥ d·ªØ li·ªáu t·ªïng quan. H√£y ki·ªÉm tra c√°c sheet "t·ªïng quan" v√† "Ti·∫øn ƒë·ªô h·ªì s∆°" trong file Excel.</p>';
        return;
      }

      let avgRatio = 0;
      if (overview.length) {
        let sumRatio = 0, countRatio = 0;
        overview.forEach(o => {
          if (typeof o.ratio === 'number' && isFinite(o.ratio) && o.ratio > 0) {
            sumRatio += o.ratio;
            countRatio++;
          }
        });
        avgRatio = countRatio ? (sumRatio / countRatio) : 0;
      }

      const docsArr = docs || [];
      const totalDocs = docsArr.length;
      let docsDone = 0, docsInProgress = 0, docsPending = 0;
      docsArr.forEach(d => {
        const s = (d.status || '').toLowerCase();
        if (!s) docsPending++;
        else if (s.includes('ho√†n th√†nh')) docsDone++;
        else if (s.includes('ƒëang') || s.includes('x·ª≠ l√Ω') || s.includes('xu ly')) docsInProgress++;
        else docsPending++;
      });

      let html = '';

      html += '<div class="summary-grid">';
      html += `
        <div class="summary-card">
          <div class="summary-label">Ti·∫øn ƒë·ªô h·ª£p ƒë·ªìng</div>
          <div class="summary-main-value">${overview.length ? formatPercent(avgRatio) : '--'}</div>
        </div>
      `;
      html += `
        <div class="summary-card">
          <div class="summary-label">Ti·∫øn ƒë·ªô h·ªì s∆°</div>
          <div class="summary-main-value">
            ${totalDocs ? (docsDone + '/' + totalDocs + ' h·ªì s∆° ho√†n th√†nh') : '--'}
          </div>
          <div class="summary-subtext">
            ƒêang x·ª≠ l√Ω: <strong>${docsInProgress || 0}</strong> &nbsp;|&nbsp;
            Ch∆∞a ho√†n th√†nh: <strong>${docsPending || 0}</strong>
          </div>
        </div>
      `;
      html += '</div>';

      if (overview.length) {
        html += '<h2 style="font-size:14px;margin:12px 4px 6px;">T·ªïng quan ti·∫øn ƒë·ªô h·ª£p ƒë·ªìng</h2>';
        html += '<div class="table-wrapper"><table class="table-main"><thead><tr>'
             +   '<th>STT</th>'
             +   '<th>Nh√† th·∫ßu</th>'
             +   '<th>G√≥i th·∫ßu</th>'
             +   '<th>Ti·∫øn ƒë·ªô Hƒê (ng√†y)</th>'
             +   '<th>Ng√†y kh·ªüi c√¥ng</th>'
             +   '<th>Ng√†y k·∫øt th√∫c</th>'
             +   '<th>Ng√†y th·ª±c hi·ªán</th>'
             +   '<th>Ng√†y c√≤n l·∫°i</th>'
             +   '<th>T·ª∑ l·ªá ho√†n th√†nh</th>'
             + '</tr></thead><tbody>';

        overview.forEach((o, idx) => {
          html += '<tr>'
               +   '<td>' + (idx + 1) + '</td>'
               +   '<td>' + (o.contractor || '') + '</td>'
               +   '<td>' + (o.pkg || '') + '</td>'
               +   '<td style="text-align:right;">' + (o.contractDays || '') + '</td>'
               +   '<td>' + formatExcelDate(o.startDate) + '</td>'
               +   '<td>' + formatExcelDate(o.endDate) + '</td>'
               +   '<td style="text-align:right;">' + (o.daysDone || '') + '</td>'
               +   '<td style="text-align:right;">' + (o.daysRemain || '') + '</td>'
               +   '<td style="text-align:right;">' + (o.ratio ? formatPercent(o.ratio) : '') + '</td>'
               + '</tr>';
        });

        html += '</tbody></table></div>';
      }

      if (docs.length) {
        html += '<h2 style="font-size:14px;margin:16px 4px 6px;">Ti·∫øn ƒë·ªô h·ªì s∆°</h2>';
        html += '<div class="table-wrapper"><table class="table-main"><thead><tr>'
             +   '<th>STT</th>'
             +   '<th>T√™n h·ªì s∆°</th>'
             +   '<th>Ng√†y tr√¨nh duy·ªát</th>'
             +   '<th>T√¨nh tr·∫°ng</th>'
             +   '<th>Ng√†y ph√™ duy·ªát</th>'
             + '</tr></thead><tbody>';

        docs.forEach((d, idx) => {
          html += '<tr>'
               +   '<td>' + (idx + 1) + '</td>'
               +   '<td>' + (d.name || '') + '</td>'
               +   '<td>' + formatExcelDate(d.submitDate) + '</td>'
               +   '<td>' + (d.status || '') + '</td>'
               +   '<td>' + formatExcelDate(d.approvedDate) + '</td>'
               + '</tr>';
        });

        html += '</tbody></table></div>';
      }

      contentEl.innerHTML = html;
      applyEllipsisTooltips(contentEl);
    }

    // ==========================
    // NH√Ä TH·∫¶U (CHI TI·∫æT + DETAIL VIEW)
    // ==========================
    function renderContractor(name) {
      const data = dataStore.contractors[name];
      if (!data) return;

      const contentEl = document.getElementById('contractor-content');
      const items = data.reportItems || [];

      let totalContract = 0, totalCum = 0;
      items.forEach(it => { totalContract += it.contractQty || 0; totalCum += it.cum || 0; });

      const avgPct = totalContract > 0 ? (totalCum / totalContract) * 100 : 0;

      const bands = Array(10).fill(0);
      items.forEach(it => {
        const p = it.pct || 0;
        let idx = Math.floor(p / 10);
        if (idx < 0) idx = 0;
        if (idx > 9) idx = 9;
        bands[idx]++;
      });

      const issues = data.issues || [];
      const totalIssues = issues.length;
      let issueOpen = 0, issueProgress = 0, issueClosed = 0;
      issues.forEach(is => {
        const cls = getIssueTagClass(is.status);
        if (cls === 'tag-open') issueOpen++;
        else if (cls === 'tag-progress') issueProgress++;
        else issueClosed++;
      });

      const contractorName = name || 'Nh√† th·∫ßu';

      const firstRowBands  = bands.slice(0,5);
      const secondRowBands = bands.slice(5,10);

      let html = '';

      // Kh·ªëi summary + chart
      html += '<div class="summary-grid">';
      html += `
        <div class="summary-card">
          <div class="summary-label">Ti·∫øn ƒë·ªô trung b√¨nh</div>
          <div class="summary-main-value">${avgPct.toFixed(1)}%</div>

          <div class="card-subtitle">M·ª©c ƒë·ªô h·∫°ng m·ª•c theo d·∫£i %</div>
          <div class="bands-row">
            ${firstRowBands.map((cnt, idx) => {
              const from = idx * 10, to = (idx + 1) * 10;
              return `<span class="chip">${from}-${to}%: <strong>${cnt}</strong></span>`;
            }).join(' ')}
          </div>
          <div class="bands-row">
            ${secondRowBands.map((cnt, idx) => {
              const from = (idx + 5) * 10, to = (idx + 6) * 10;
              return `<span class="chip">${from}-${to}%: <strong>${cnt}</strong></span>`;
            }).join(' ')}
          </div>

          <div class="card-subtitle" style="margin-top:6px;">T√¨nh tr·∫°ng v∆∞·ªõng m·∫Øc</div>
          <div class="summary-main-value" style="font-size:18px;margin-bottom:2px;">${totalIssues}</div>
          <div class="summary-subtext">
            <span class="tag tag-open">Ch∆∞a x·ª≠ l√Ω: <strong>${issueOpen}</strong></span>
            <span class="tag tag-progress">ƒêang x·ª≠ l√Ω: <strong>${issueProgress}</strong></span>
            <span class="tag tag-closed">ƒê√£ xong: <strong>${issueClosed}</strong></span>
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-label">Bi·ªÉu ƒë·ªì ti·∫øn ƒë·ªô t·ªïng th·ªÉ</div>
          <div class="chart-split">
            <div class="chart-half"><canvas id="chart-overall"></canvas></div>
            <div class="chart-half"><canvas id="chart-status"></canvas></div>
          </div>
          <div class="chart-legend">
            <span class="legend-item"><span class="legend-color" style="background:#06b6d4;"></span> ƒê√£ th·ª±c hi·ªán</span>
            <span class="legend-item"><span class="legend-color" style="background:#ef4444;"></span> C√≤n l·∫°i</span>
          </div>
        </div>
      `;
      html += '</div>';

      // Chi ti·∫øt kh·ªëi l∆∞·ª£ng + DETAIL VIEW
      html += `
        <div class="details-grid">
          <div class="card">
            <div class="card-title">
              <span>Chi ti·∫øt kh·ªëi l∆∞·ª£ng - ${contractorName}</span>
            </div>
            <div class="filters-row">
              <label>G√≥i th·∫ßu:
                <select id="filterPkg"></select>
              </label>
              <label>H·∫°ng m·ª•c:
                <select id="filterItem"></select>
              </label>
              <label>D·∫£i %:
                <select id="filterBand">
                  <option value="">T·∫•t c·∫£</option>
                  <option value=">=90">‚â• 90% (g·∫ßn ho√†n th√†nh)</option>
                  <option value="<50">&lt; 50% (ch·∫≠m)</option>
                </select>
              </label>
            </div>
            <div class="table-wrapper">
              <table class="table-main">
                <thead>
                  <tr>
                    <th>G√≥i th·∫ßu</th>
                    <th>H·∫°ng m·ª•c</th>
                    <th>ƒê∆°n v·ªã</th>
                    <th>KL Hƒê</th>
                    <th>L≈©y k·∫ø tr∆∞·ªõc</th>
                    <th>Tu·∫ßn n√†y</th>
                    <th>L≈©y k·∫ø ƒë·∫øn nay</th>
                    <th>% ho√†n th√†nh</th>
                    <th>Ghi ch√∫</th>
                  </tr>
                </thead>
                <tbody id="tbody-main"></tbody>
              </table>
            </div>
          </div>

          <div class="card" id="detail-main-card">
            <div class="card-title">
              <span>Chi ti·∫øt h·∫°ng m·ª•c ƒë∆∞·ª£c ch·ªçn</span>
            </div>
            <div id="detail-main-empty" class="detail-empty">
              Ch∆∞a ch·ªçn d√≤ng n√†o trong b·∫£ng kh·ªëi l∆∞·ª£ng. H√£y click v√†o m·ªôt d√≤ng ƒë·ªÉ xem chi ti·∫øt.
            </div>
            <div id="detail-main" class="detail-grid" style="display:none;">
              <div class="detail-row">
                <div class="detail-label">G√≥i th·∫ßu:</div>
                <div class="detail-value" id="detailPkg"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">H·∫°ng m·ª•c:</div>
                <div class="detail-value" id="detailItem"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">ƒê∆°n v·ªã:</div>
                <div class="detail-value" id="detailUnit"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">KL Hƒê:</div>
                <div class="detail-value" id="detailContractQty"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">L≈©y k·∫ø tr∆∞·ªõc:</div>
                <div class="detail-value" id="detailPrevCum"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Tu·∫ßn n√†y:</div>
                <div class="detail-value" id="detailThisWeek"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">L≈©y k·∫ø ƒë·∫øn nay:</div>
                <div class="detail-value" id="detailCum"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">% ho√†n th√†nh:</div>
                <div class="detail-value" id="detailPct"></div>
              </div>
              <div class="detail-row" style="grid-column:1 / -1;">
                <div class="detail-label">Ghi ch√∫:</div>
                <div class="detail-value" id="detailNote"></div>
              </div>
            </div>
          </div>
        </div>
      `;

      // Danh s√°ch v∆∞·ªõng m·∫Øc + DETAIL VIEW
      html += `
        <div class="details-grid" style="margin-top:10px;">
          <div class="card">
            <div class="card-title">
              <span>Danh s√°ch v∆∞·ªõng m·∫Øc</span>
              <span class="badge"><span class="badge-dot"></span> ${contractorName}</span>
            </div>
            <div class="table-wrapper">
              <table class="table-main">
                <thead>
                  <tr>
                    <th>H·∫°ng m·ª•c</th>
                    <th>V∆∞·ªõng m·∫Øc</th>
                    <th>Ki·∫øn ngh·ªã</th>
                    <th>Ng√†y ph√°t sinh</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>ƒê∆°n v·ªã ph·ª• tr√°ch</th>
                    <th>H·∫°n gi·∫£i quy·∫øt</th>
                  </tr>
                </thead>
                <tbody id="tbody-issues"></tbody>
              </table>
            </div>
          </div>

          <div class="card" id="detail-issue-card">
            <div class="card-title">
              <span>Chi ti·∫øt v∆∞·ªõng m·∫Øc ƒë∆∞·ª£c ch·ªçn</span>
            </div>
            <div id="detail-issue-empty" class="detail-empty">
              Ch∆∞a ch·ªçn d√≤ng n√†o trong b·∫£ng v∆∞·ªõng m·∫Øc. H√£y click v√†o m·ªôt d√≤ng ƒë·ªÉ xem chi ti·∫øt.
            </div>
            <div id="detail-issue" class="detail-grid" style="display:none;">
              <div class="detail-row">
                <div class="detail-label">H·∫°ng m·ª•c:</div>
                <div class="detail-value" id="detailIssueItem"></div>
              </div>
              <div class="detail-row" style="grid-column:1 / -1;">
                <div class="detail-label">V∆∞·ªõng m·∫Øc:</div>
                <div class="detail-value" id="detailIssueIssue"></div>
              </div>
              <div class="detail-row" style="grid-column:1 / -1;">
                <div class="detail-label">Ki·∫øn ngh·ªã:</div>
                <div class="detail-value" id="detailIssueProposal"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Ng√†y ph√°t sinh:</div>
                <div class="detail-value" id="detailIssueDateRaised"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Tr·∫°ng th√°i:</div>
                <div class="detail-value" id="detailIssueStatus"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">ƒê∆°n v·ªã ph·ª• tr√°ch:</div>
                <div class="detail-value" id="detailIssueOwner"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">H·∫°n gi·∫£i quy·∫øt:</div>
                <div class="detail-value" id="detailIssueDueDate"></div>
              </div>
            </div>
          </div>
        </div>
      `;

      contentEl.innerHTML = html;

      // ====== FILTER + B·∫¢NG CHI TI·∫æT KH·ªêI L∆Ø·ª¢NG ======
      const contractorsData = dataStore.contractors[name];
      const pkgs = Array.from(new Set((contractorsData.reportItems || []).map(it => it.pkg || ''))).sort();
      const pkgSelect = document.getElementById('filterPkg');
      pkgSelect.innerHTML =
        '<option value="">T·∫•t c·∫£</option>' +
        pkgs.map(p => `<option value="${p}">${p || '(Kh√¥ng c√≥)'}</option>`).join('');

      const itemsSet = new Set();
      (contractorsData.reportItems || []).forEach(it => { if (it.item) itemsSet.add(it.item); });
      const itemsArr = Array.from(itemsSet).sort();
      const itemSelect = document.getElementById('filterItem');
      itemSelect.innerHTML =
        '<option value="">T·∫•t c·∫£</option>' +
        itemsArr.map(p => `<option value="${p}">${p}</option>`).join('');

      let selectedMainRow = null;

      function updateMainDetail(it) {
        document.getElementById('detail-main-empty').style.display = 'none';
        document.getElementById('detail-main').style.display = 'grid';

        document.getElementById('detailPkg').textContent          = it.pkg || '';
        document.getElementById('detailItem').textContent         = it.item || '';
        document.getElementById('detailUnit').textContent         = it.unit || '';
        document.getElementById('detailContractQty').textContent  = (it.contractQty || 0).toLocaleString('vi-VN');
        document.getElementById('detailPrevCum').textContent      = (it.prevCum || 0).toLocaleString('vi-VN');
        document.getElementById('detailThisWeek').textContent     = (it.thisWeek || 0).toLocaleString('vi-VN');
        document.getElementById('detailCum').textContent          = (it.cum || 0).toLocaleString('vi-VN');
        document.getElementById('detailPct').textContent          = (it.pct || 0).toFixed(1) + '%';
        document.getElementById('detailNote').textContent         = it.note || '';
      }

      function renderTable() {
        const pkgFilter  = pkgSelect.value;
        const itemFilter = itemSelect.value;
        const bandFilter = document.getElementById('filterBand').value;

        const tbody = document.getElementById('tbody-main');
        tbody.innerHTML = '';
        selectedMainRow = null;
        document.getElementById('detail-main-empty').style.display = 'block';
        document.getElementById('detail-main').style.display = 'none';

        (contractorsData.reportItems || []).forEach(it => {
          if (pkgFilter && it.pkg !== pkgFilter) return;
          if (itemFilter && it.item !== itemFilter) return;
          if (bandFilter === '>=90' && (it.pct || 0) < 90) return;
          if (bandFilter === '<50' && (it.pct || 0) >= 50) return;

          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${it.pkg}</td>
            <td>${it.item}</td>
            <td>${it.unit}</td>
            <td>${(it.contractQty || 0).toLocaleString('vi-VN')}</td>
            <td>${(it.prevCum || 0).toLocaleString('vi-VN')}</td>
            <td>${(it.thisWeek || 0).toLocaleString('vi-VN')}</td>
            <td>${(it.cum || 0).toLocaleString('vi-VN')}</td>
            <td>${(it.pct || 0).toFixed(1)}%</td>
            <td><div class="note-cell">${it.note || ''}</div></td>
          `;

          tr.addEventListener('click', () => {
            if (selectedMainRow) selectedMainRow.classList.remove('row-selected');
            tr.classList.add('row-selected');
            selectedMainRow = tr;
            updateMainDetail(it);
          });

          tbody.appendChild(tr);
        });
        applyEllipsisTooltips(tbody);
      }

      renderTable();

      pkgSelect.addEventListener('change', renderTable);
      itemSelect.addEventListener('change', renderTable);
      document.getElementById('filterBand').addEventListener('change', renderTable);

      // ====== B·∫¢NG V∆Ø·ªöNG M·∫ÆC + DETAIL VIEW ======
      const issuesTbody = document.getElementById('tbody-issues');
      issuesTbody.innerHTML = '';

      let selectedIssueRow = null;

      function updateIssueDetail(is) {
        document.getElementById('detail-issue-empty').style.display = 'none';
        document.getElementById('detail-issue').style.display = 'grid';

        document.getElementById('detailIssueItem').textContent       = is.item || '';
        document.getElementById('detailIssueIssue').textContent      = is.issue || '';
        document.getElementById('detailIssueProposal').textContent   = is.proposal || '';
        document.getElementById('detailIssueDateRaised').textContent = is.dateRaised || '';
        document.getElementById('detailIssueStatus').textContent     = is.status || '';
        document.getElementById('detailIssueOwner').textContent      = is.owner || '';
        document.getElementById('detailIssueDueDate').textContent    = is.dueDate || '';
      }

      (data.issues || []).forEach(is => {
        const cls = getIssueTagClass(is.status);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${is.item || ''}</td>
          <td>${is.issue || ''}</td>
          <td>${is.proposal || ''}</td>
          <td>${is.dateRaised || ''}</td>
          <td><span class="tag ${cls}">${is.status || ''}</span></td>
          <td>${is.owner || ''}</td>
          <td>${is.dueDate || ''}</td>
        `;
        tr.addEventListener('click', () => {
          if (selectedIssueRow) selectedIssueRow.classList.remove('row-selected');
          tr.classList.add('row-selected');
          selectedIssueRow = tr;
          updateIssueDetail(is);
        });
        issuesTbody.appendChild(tr);
      });

      // ====== CHARTS ======
      if (charts && charts.length) {
        charts.forEach(ch => ch.destroy());
        charts = [];
      }

      const ctxOverall = document.getElementById('chart-overall');
      const ctxStatus  = document.getElementById('chart-status');

      if (ctxOverall) {
        const done = totalCum;
        const remainVal = Math.max(0, totalContract - totalCum);
        const doughnutChart = new Chart(ctxOverall, {
          type: 'doughnut',
          data: {
            labels: ['ƒê√£ th·ª±c hi·ªán', 'C√≤n l·∫°i'],
            datasets: [{
              data: [done, remainVal],
              backgroundColor: ['#06b6d4', '#ef4444'],
              borderWidth: 0
            }]
          },
          options: {
            plugins: {
              legend: { display:false },
              tooltip: {
                callbacks: {
                  label: function(ctx) {
                    const label = ctx.label || '';
                    const value = ctx.parsed || 0;
                    return label + ': ' + value.toLocaleString('vi-VN');
                  }
                }
              }
            },
            cutout: '65%'
          }
        });
        charts.push(doughnutChart);
      }

      if (ctxStatus) {
        const labels = [];
        for (let i = 0; i < 10; i++) labels.push((i*10) + '-' + ((i+1)*10) + '%');
        const barChart = new Chart(ctxStatus, {
          type: 'bar',
          data: { labels, datasets: [{ data: bands, backgroundColor:'#38bdf8', borderWidth:0 }] },
          options: {
            plugins: {
              legend: { display:false },
              tooltip: {
                callbacks: { label: ctx => ctx.parsed.y + ' h·∫°ng m·ª•c' }
              }
            },
            scales: {
              x: {
                ticks: { font: { size:9 } },
                grid: { display:false }
              },
              y: {
                beginAtZero:true,
                precision:0,
                grid: { color:'rgba(148,163,184,0.35)' },
                ticks: { stepSize:1 }
              }
            }
          }
        });
        charts.push(barChart);
      }

      applyEllipsisTooltips();
    }

    // ==========================
    // EXPORT & THEME
    // ==========================
    document.getElementById('btnExportExcel').addEventListener('click', () => {
      const contractors = dataStore.contractors;
      if (!Object.keys(contractors || {}).length) {
        alert('Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y nh·∫≠p file Excel tr∆∞·ªõc.');
        return;
      }

      const reportRows = [];
      const issueRows  = [];

      Object.values(contractors).forEach(ct => {
        (ct.reportItems || []).forEach(it => {
          reportRows.push({
            'Nh√† th·∫ßu': it.contractor,
            'G√≥i th·∫ßu': it.pkg,
            'H·∫°ng m·ª•c': it.item,
            'ƒê∆°n v·ªã': it.unit,
            'KL Hƒê': it.contractQty,
            'L≈©y k·∫ø tr∆∞·ªõc': it.prevCum,
            'Tu·∫ßn n√†y': it.thisWeek,
            'L≈©y k·∫ø ƒë·∫øn nay': it.cum,
            '% ho√†n th√†nh': it.pct,
            'Ghi ch√∫': it.note
          });
        });

        (ct.issues || []).forEach(is => {
          issueRows.push({
            'Nh√† th·∫ßu': ct.reportItems?.[0]?.contractor || '',
            'H·∫°ng m·ª•c': is.item,
            'V∆∞·ªõng m·∫Øc': is.issue,
            'Ki·∫øn ngh·ªã': is.proposal,
            'Ng√†y ph√°t sinh': is.dateRaised,
            'Tr·∫°ng th√°i': is.status,
            'ƒê∆°n v·ªã ph·ª• tr√°ch': is.owner,
            'H·∫°n gi·∫£i quy·∫øt': is.dueDate
          });
        });
      });

      const wb = XLSX.utils.book_new();
      const wsReport = XLSX.utils.json_to_sheet(reportRows);
      XLSX.utils.book_append_sheet(wb, wsReport, 'Bao_cao_thi_cong');
      const wsIssue = XLSX.utils.json_to_sheet(issueRows);
      XLSX.utils.book_append_sheet(wb, wsIssue, 'Vuong_mac');

      const today = new Date();
      const dd = String(today.getDate()).padStart(2,'0');
      const mm = String(today.getMonth()+1).padStart(2,'0');
      const yyyy = today.getFullYear();
      XLSX.writeFile(wb, `Bao_cao_khoi_luong_${dd}${mm}${yyyy}.xlsx`);
    });

    document.getElementById('btnExportPdf').addEventListener('click', () => {
      window.print();
    });

    document.getElementById('btnExportHtml').addEventListener('click', () => {
      const authorEl = document.getElementById('reportAuthor');
      const dateEl   = document.getElementById('reportDate');
      dataStore.meta = {
        generatedAt: new Date().toISOString(),
        author: authorEl ? authorEl.textContent.trim() : '',
        reportDate: dateEl ? dateEl.textContent.trim() : ''
      };

      const scriptTag = document.getElementById('embedded-data-json');
      if (scriptTag) {
        scriptTag.textContent = JSON.stringify(dataStore);
      }

      const fullHtml = '<!DOCTYPE html>\n' + document.documentElement.outerHTML;
      const blob = new Blob([fullHtml], { type: 'text/html;charset=utf-8' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      const today = new Date();
      const dd = String(today.getDate()).padStart(2,'0');
      const mm = String(today.getMonth()+1).padStart(2,'0');
      const yyyy = today.getFullYear();
      a.download = `Bao_cao_khoi_luong_static_${dd}${mm}${yyyy}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    document.getElementById('btnTheme').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
    });
  </script>


</body></html>